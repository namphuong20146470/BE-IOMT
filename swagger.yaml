openapi: 3.0.3
info:
  title: IoMT Device Management System API - Extended
  description: |-
    # üè• **IoMT Device Management System API**
    
    **Extended API specification** cho h·ªá th·ªëng qu·∫£n l√Ω thi·∫øt b·ªã y t·∫ø IoMT.
    
    ## üîí **QUAN TR·ªåNG - B·∫¢o M·∫¨T**
    
    **T√†i li·ªáu n√†y ch·ª©a th√¥ng tin nh·∫°y c·∫£m v·ªÅ h·ªá th·ªëng y t·∫ø:**
    - ‚ö†Ô∏è **Ch·ªâ d√†nh cho nh√¢n vi√™n ƒë∆∞·ª£c ·ªßy quy·ªÅn**
    - ‚ö†Ô∏è **Kh√¥ng chia s·∫ª th√¥ng tin ƒëƒÉng nh·∫≠p**  
    - ‚ö†Ô∏è **Lu√¥n s·ª≠ d·ª•ng HTTPS trong production**
    - ‚ö†Ô∏è **B√°o c√°o ngay l·∫≠p t·ª©c n·∫øu ph√°t hi·ªán truy c·∫≠p b·∫•t th∆∞·ªùng**
    
    **Truy c·∫≠p t√†i li·ªáu n√†y ƒë∆∞·ª£c gi√°m s√°t v√† ghi log.**
    
    ---
    
    ## üöÄ **T√≠nh NƒÉng**
    
    - **Core APIs**: Authentication, CRUD operations
    - **Advanced Features**: Statistics, Analytics, Dashboard
    - **Full CRUD**: T·∫•t c·∫£ entities v·ªõi validation
    - **Roles & Permissions**: H·ªá th·ªëng ph√¢n quy·ªÅn ph·ª©c t·∫°p
    - **Real-time**: Socket.IO + MQTT subscriptions
    - **Search & Filter**: Advanced query capabilities
    - **Audit Trail**: Theo d√µi m·ªçi thay ƒë·ªïi d·ªØ li·ªáu
    
    ## üîê **X√°c Th·ª±c**
    
    **3 ph∆∞∆°ng th·ª©c x√°c th·ª±c ƒë∆∞·ª£c h·ªó tr·ª£:**
    
    1. **JWT Bearer Token** (khuy·∫øn ngh·ªã): `Authorization: Bearer <token>`
    2. **API Key**: `X-API-Key: <key>` (cho service integration)  
    3. **HttpOnly Cookie**: T·ª± ƒë·ªông sau khi login (cho web apps)
    
    **ƒê·ªÉ b·∫Øt ƒë·∫ßu:**
    1. ƒêƒÉng nh·∫≠p qua `/auth/login` 
    2. S·ª≠ d·ª•ng token nh·∫≠n ƒë∆∞·ª£c trong header Authorization
    3. Token h·∫øt h·∫°n sau 24h, refresh b·∫±ng `/auth/refresh`
    
    ## ‚ö° **Rate Limiting**
    
    - **300 requests/minute** per user/API key
    - **Swagger UI**: 100 requests/15 ph√∫t  
    - Header `X-RateLimit-Remaining` hi·ªÉn th·ªã s·ªë request c√≤n l·∫°i
    - Header `Retry-After` hi·ªÉn th·ªã th·ªùi gian ch·ªù khi b·ªã limit
    
    ## üõ°Ô∏è **B·∫£o M·∫≠t**
    
    - **TLS 1.2+** b·∫Øt bu·ªôc cho production
    - **JWT tokens** c√≥ th·ªùi h·∫°n v√† ƒë∆∞·ª£c sign
    - **Password hashing** v·ªõi bcrypt + salt
    - **SQL Injection prevention** v·ªõi Prisma ORM
    - **CORS protection** v·ªõi whitelist domains
    - **Input validation** v·ªõi Joi schemas
    
    ## üìû **H·ªó Tr·ª£**
    
    **Trong tr∆∞·ªùng h·ª£p kh·∫©n c·∫•p ho·∫∑c v·∫•n ƒë·ªÅ b·∫£o m·∫≠t:**
    - üìß Email: security@iomt.com (urgent)
    - üìû Hotline: +84-xxx-xxx-xxx (24/7)
    - üí¨ Slack: #iomt-support
    
  version: 2.0.0
  contact:
    name: IoMT Development Team
    email: support@iomt.com
    url: https://iomt.hoangphucthanh.vn/support
  license:
    name: Proprietary License
    url: https://iomt.hoangphucthanh.vn/license

servers:
  - url: https://iomt.hoangphucthanh.vn
    description: |-
      üîí **Production Server** (TLS 1.2+ Required)
      
      - All traffic encrypted with HTTPS
      - Rate limited: 300 req/min per user
      - Monitored 24/7 v·ªõi security alerts
      - Backup every 6 hours
      
  - url: http://localhost:3030  
    description: |-
      üöß **Development Server** (HTTPS)
      
      - Local development v·ªõi SSL certificate
      - Relaxed rate limits
      - Debug logging enabled
      - Hot reload support
      
  - url: http://localhost:3031
    description: |-
      üîÑ **HTTP Redirect Server** 
      
      - Automatically redirects to HTTPS (3030)
      - For legacy client compatibility only
      - No API endpoints served directly

# üîê Global Security (Most endpoints require authentication)
security:
  - BearerAuth: []
  - CookieAuth: []

tags:
  - name: Authentication
    description: ƒêƒÉng nh·∫≠p, ƒëƒÉng xu·∫•t, qu·∫£n l√Ω token & permissions
  - name: Users
    description: Qu·∫£n l√Ω ng∆∞·ªùi d√πng ƒë·∫ßy ƒë·ªß
  - name: Roles & Permissions
    description: Qu·∫£n l√Ω vai tr√≤ v√† quy·ªÅn h·∫°n chi ti·∫øt
  - name: Organizations
    description: Qu·∫£n l√Ω t·ªï ch·ª©c v·ªõi statistics
  - name: Departments
    description: Qu·∫£n l√Ω ph√≤ng ban v·ªõi statistics
  - name: Devices
    description: Full CRUD thi·∫øt b·ªã + statistics
  - name: Device Categories
    description: Qu·∫£n l√Ω danh m·ª•c thi·∫øt b·ªã
  - name: Device Models
    description: Qu·∫£n l√Ω model thi·∫øt b·ªã
  - name: MQTT & IoT
    description: K·∫øt n·ªëi v√† gi√°m s√°t thi·∫øt b·ªã IoT
  - name: Device Data
    description: D·ªØ li·ªáu sensor real-time & history
  - name: Maintenance
    description: H·ªá th·ªëng b·∫£o tr√¨ ƒë·∫ßy ƒë·ªß + cost analysis
  - name: Alerts & Warnings
    description: H·ªá th·ªëng c·∫£nh b√°o v·ªõi dashboard & statistics

paths:
  # ============================================================
  # AUTHENTICATION - EXTENDED
  # ============================================================
  /auth/login:
    post:
      tags: [Authentication]
      summary: ƒêƒÉng nh·∫≠p v√†o h·ªá th·ªëng
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                  example: admin
                password:
                  type: string
                  format: password
                  example: password123
      responses:
        '200':
          description: ƒêƒÉng nh·∫≠p th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokens'
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /auth/logout:
    post:
      tags: [Authentication]
      summary: ƒêƒÉng xu·∫•t kh·ªèi h·ªá th·ªëng
      operationId: logout
      security:
        - BearerAuth: []
      responses:
        '200':
          description: ƒêƒÉng xu·∫•t th√†nh c√¥ng
        '401':
          $ref: '#/components/responses/UnauthorizedError'

  /auth/refresh:
    post:
      tags: [Authentication]
      summary: L√†m m·ªõi access token
      operationId: refreshToken
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [refresh_token]
              properties:
                refresh_token:
                  type: string
      responses:
        '200':
          description: Token m·ªõi
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthTokens'

  /auth/me:
    get:
      tags: [Authentication]
      summary: L·∫•y th√¥ng tin user hi·ªán t·∫°i
      operationId: getCurrentUser
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /auth/permissions:
    get:
      tags: [Authentication]
      summary: L·∫•y permissions c·ªßa user hi·ªán t·∫°i
      operationId: getCurrentUserPermissions
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch permissions
          content:
            application/json:
              schema:
                type: object
                properties:
                  permissions:
                    type: array
                    items:
                      type: string
                    example: ['device:read', 'device:write', 'user:manage']

  # ============================================================
  # USERS - FULL CRUD + ROLES/PERMISSIONS
  # ============================================================
  /users:
    get:
      tags: [Users]
      summary: L·∫•y danh s√°ch ng∆∞·ªùi d√πng v·ªõi filtering
      operationId: getUsers
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: organization_id
          in: query
          schema:
            type: string
            format: uuid
        - name: role
          in: query
          schema:
            type: string
        - name: search
          in: query
          description: T√¨m ki·∫øm theo username, email, full_name
          schema:
            type: string
      responses:
        '200':
          description: Danh s√°ch ng∆∞·ªùi d√πng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserListResponse'

    post:
      tags: [Users]
      summary: T·∫°o ng∆∞·ªùi d√πng m·ªõi
      operationId: createUser
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserCreate'
      responses:
        '201':
          description: T·∫°o th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

  /users/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Users]
      summary: L·∫•y th√¥ng tin user theo ID
      operationId: getUserById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          $ref: '#/components/responses/NotFoundError'

    put:
      tags: [Users]
      summary: C·∫≠p nh·∫≠t th√¥ng tin user
      operationId: updateUser
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserUpdate'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'

    delete:
      tags: [Users]
      summary: X√≥a user
      operationId: deleteUser
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng
        '404':
          $ref: '#/components/responses/NotFoundError'

  /users/{id}/roles:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Users]
      summary: L·∫•y roles c·ªßa user
      operationId: getUserRoles
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch roles
          content:
            application/json:
              schema:
                type: object
                properties:
                  roles:
                    type: array
                    items:
                      $ref: '#/components/schemas/Role'

    post:
      tags: [Users]
      summary: G√°n role cho user
      operationId: assignUserRole
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role_id]
              properties:
                role_id:
                  type: string
                  format: uuid
      responses:
        '200':
          description: G√°n role th√†nh c√¥ng

  /users/{id}/permissions:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Users]
      summary: L·∫•y permissions c·ªßa user
      operationId: getUserPermissions
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch permissions
          content:
            application/json:
              schema:
                type: object
                properties:
                  permissions:
                    type: array
                    items:
                      $ref: '#/components/schemas/Permission'

  # ============================================================
  # ROLES & PERMISSIONS
  # ============================================================
  /roles:
    get:
      tags: [Roles & Permissions]
      summary: L·∫•y danh s√°ch roles
      operationId: getRoles
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Role'

    post:
      tags: [Roles & Permissions]
      summary: T·∫°o role m·ªõi
      operationId: createRole
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleCreate'
      responses:
        '201':
          description: T·∫°o th√†nh c√¥ng
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'

  /roles/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Roles & Permissions]
      summary: L·∫•y role theo ID
      operationId: getRoleById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin role
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Role'

    put:
      tags: [Roles & Permissions]
      summary: C·∫≠p nh·∫≠t role
      operationId: updateRole
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RoleUpdate'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng

    delete:
      tags: [Roles & Permissions]
      summary: X√≥a role
      operationId: deleteRole
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng

  /permissions:
    get:
      tags: [Roles & Permissions]
      summary: L·∫•y danh s√°ch permissions
      operationId: getPermissions
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch permissions
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Permission'

  # ============================================================
  # ORGANIZATIONS - EXTENDED WITH STATISTICS
  # ============================================================
  /organizations:
    get:
      tags: [Organizations]
      summary: L·∫•y danh s√°ch t·ªï ch·ª©c
      operationId: getOrganizations
      security:
        - BearerAuth: []
      parameters:
        - name: type
          in: query
          schema:
            type: string
            enum: [hospital, clinic, laboratory]
      responses:
        '200':
          description: Danh s√°ch t·ªï ch·ª©c
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Organization'

    post:
      tags: [Organizations]
      summary: T·∫°o t·ªï ch·ª©c m·ªõi
      operationId: createOrganization
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrganizationCreate'
      responses:
        '201':
          description: T·∫°o th√†nh c√¥ng

  /organizations/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Organizations]
      summary: L·∫•y organization theo ID
      operationId: getOrganizationById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'

    put:
      tags: [Organizations]
      summary: C·∫≠p nh·∫≠t organization
      operationId: updateOrganization
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OrganizationUpdate'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng

    delete:
      tags: [Organizations]
      summary: X√≥a organization
      operationId: deleteOrganization
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng

  /organizations/me:
    get:
      tags: [Organizations]
      summary: L·∫•y organization c·ªßa user hi·ªán t·∫°i
      operationId: getMyOrganization
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin organization
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Organization'

  /organizations/{id}/statistics:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Organizations]
      summary: L·∫•y th·ªëng k√™ c·ªßa organization
      operationId: getOrganizationStatistics
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Statistics data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrganizationStatistics'

  # ============================================================
  # DEPARTMENTS - EXTENDED WITH STATISTICS
  # ============================================================
  /departments:
    get:
      tags: [Departments]
      summary: L·∫•y danh s√°ch ph√≤ng ban
      operationId: getDepartments
      security:
        - BearerAuth: []
      parameters:
        - name: organization_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Danh s√°ch ph√≤ng ban
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Department'

    post:
      tags: [Departments]
      summary: T·∫°o ph√≤ng ban m·ªõi
      operationId: createDepartment
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DepartmentCreate'
      responses:
        '201':
          description: T·∫°o th√†nh c√¥ng

  /departments/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Departments]
      summary: L·∫•y department theo ID
      operationId: getDepartmentById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin department
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Department'

    put:
      tags: [Departments]
      summary: C·∫≠p nh·∫≠t department
      operationId: updateDepartment
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DepartmentUpdate'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng

    delete:
      tags: [Departments]
      summary: X√≥a department
      operationId: deleteDepartment
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng

  /departments/organization/{orgId}:
    parameters:
      - name: orgId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Departments]
      summary: L·∫•y departments theo organization
      operationId: getDepartmentsByOrganization
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch departments
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Department'

  /departments/{id}/statistics:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Departments]
      summary: L·∫•y th·ªëng k√™ c·ªßa department
      operationId: getDepartmentStatistics
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Statistics data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DepartmentStatistics'

  # ============================================================
  # DEVICES - FULL CRUD + STATISTICS
  # ============================================================
  /devices:
    get:
      tags: [Devices]
      summary: L·∫•y danh s√°ch thi·∫øt b·ªã v·ªõi filtering n√¢ng cao
      operationId: getDevices
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [active, maintenance, retired, inactive]
        - name: organization_id
          in: query
          schema:
            type: string
            format: uuid
        - name: department_id
          in: query
          schema:
            type: string
            format: uuid
        - name: category_id
          in: query
          schema:
            type: string
            format: uuid
        - name: search
          in: query
          description: T√¨m ki·∫øm theo device_code, serial_number
          schema:
            type: string
      responses:
        '200':
          description: Danh s√°ch thi·∫øt b·ªã
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceListResponse'

    post:
      tags: [Devices]
      summary: Th√™m thi·∫øt b·ªã m·ªõi
      operationId: createDevice
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceCreate'
      responses:
        '201':
          description: T·∫°o th√†nh c√¥ng

  /devices/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Devices]
      summary: L·∫•y th√¥ng tin thi·∫øt b·ªã
      operationId: getDeviceById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin thi·∫øt b·ªã
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Device'

    put:
      tags: [Devices]
      summary: C·∫≠p nh·∫≠t thi·∫øt b·ªã
      operationId: updateDevice
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceUpdate'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng

    delete:
      tags: [Devices]
      summary: X√≥a thi·∫øt b·ªã
      operationId: deleteDevice
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng

  /devices/statistics:
    get:
      tags: [Devices]
      summary: L·∫•y th·ªëng k√™ t·ªïng quan v·ªÅ thi·∫øt b·ªã
      operationId: getDevicesStatistics
      security:
        - BearerAuth: []
      parameters:
        - name: organization_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Device statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceStatistics'

  /devices/{id}/summary:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Devices]
      summary: L·∫•y t·ªïng h·ª£p d·ªØ li·ªáu thi·∫øt b·ªã
      operationId: getDeviceSummary
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Device data summary
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceSummary'

  /devices/{id}/realtime:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Device Data]
      summary: L·∫•y d·ªØ li·ªáu real-time m·ªõi nh·∫•t
      operationId: getDeviceRealtimeData
      security:
        - BearerAuth: []
      responses:
        '200':
          description: D·ªØ li·ªáu real-time
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SensorData'

  /devices/{id}/history:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Device Data]
      summary: L·∫•y l·ªãch s·ª≠ d·ªØ li·ªáu sensor
      operationId: getDeviceHistory
      security:
        - BearerAuth: []
      parameters:
        - name: start_date
          in: query
          required: true
          schema:
            type: string
            format: date-time
        - name: end_date
          in: query
          required: true
          schema:
            type: string
            format: date-time
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
      responses:
        '200':
          description: L·ªãch s·ª≠ d·ªØ li·ªáu
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SensorData'

  # ============================================================
  # ALERTS - FULL MANAGEMENT + STATISTICS
  # ============================================================
  /alerts:
    get:
      tags: [Alerts & Warnings]
      summary: L·∫•y danh s√°ch c·∫£nh b√°o v·ªõi filtering
      operationId: getAlerts
      security:
        - BearerAuth: []
      parameters:
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/LimitParam'
        - name: status
          in: query
          schema:
            type: string
            enum: [new, acknowledged, resolved]
        - name: severity
          in: query
          schema:
            type: string
            enum: [low, medium, high, critical]
        - name: device_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Danh s√°ch c·∫£nh b√°o
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertListResponse'

  /alerts/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Alerts & Warnings]
      summary: L·∫•y alert theo ID
      operationId: getAlertById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin alert
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Alert'

    delete:
      tags: [Alerts & Warnings]
      summary: X√≥a alert
      operationId: deleteAlert
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng

  /alerts/device/{deviceId}:
    parameters:
      - name: deviceId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Alerts & Warnings]
      summary: L·∫•y alerts theo device
      operationId: getAlertsByDevice
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch alerts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Alert'

  /alerts/active:
    get:
      tags: [Alerts & Warnings]
      summary: L·∫•y c√°c alerts ƒëang active
      operationId: getActiveAlerts
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Active alerts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Alert'

  /alerts/critical:
    get:
      tags: [Alerts & Warnings]
      summary: L·∫•y c√°c alerts critical
      operationId: getCriticalAlerts
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Critical alerts
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Alert'

  /alerts/statistics:
    get:
      tags: [Alerts & Warnings]
      summary: Th·ªëng k√™ alerts
      operationId: getAlertStatistics
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Alert statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertStatistics'

  /alerts/dashboard:
    get:
      tags: [Alerts & Warnings]
      summary: D·ªØ li·ªáu dashboard cho alerts
      operationId: getAlertDashboard
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Dashboard data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AlertDashboard'

  /alerts/{id}/status:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    patch:
      tags: [Alerts & Warnings]
      summary: C·∫≠p nh·∫≠t tr·∫°ng th√°i alert
      operationId: updateAlertStatus
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [status]
              properties:
                status:
                  type: string
                  enum: [new, acknowledged, resolved]
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng

  /alerts/{id}/acknowledge:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    post:
      tags: [Alerts & Warnings]
      summary: Acknowledge alert
      operationId: acknowledgeAlert
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
      responses:
        '200':
          description: Acknowledged th√†nh c√¥ng

  /alerts/{id}/resolve:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    post:
      tags: [Alerts & Warnings]
      summary: Resolve alert
      operationId: resolveAlert
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                resolution_notes:
                  type: string
      responses:
        '200':
          description: Resolved th√†nh c√¥ng

  # ============================================================
  # MAINTENANCE - FULL MANAGEMENT + COST ANALYSIS
  # ============================================================
  /maintenance/schedules:
    get:
      tags: [Maintenance]
      summary: L·∫•y l·ªãch b·∫£o tr√¨
      operationId: getMaintenanceSchedules
      security:
        - BearerAuth: []
      parameters:
        - name: device_id
          in: query
          schema:
            type: string
            format: uuid
        - name: status
          in: query
          schema:
            type: string
            enum: [pending, completed, overdue]
      responses:
        '200':
          description: Danh s√°ch l·ªãch b·∫£o tr√¨
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MaintenanceSchedule'

    post:
      tags: [Maintenance]
      summary: T·∫°o l·ªãch b·∫£o tr√¨ m·ªõi
      operationId: createMaintenanceSchedule
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MaintenanceScheduleCreate'
      responses:
        '201':
          description: T·∫°o th√†nh c√¥ng

  /maintenance/schedules/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Maintenance]
      summary: L·∫•y schedule theo ID
      operationId: getMaintenanceScheduleById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin schedule
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceSchedule'

    put:
      tags: [Maintenance]
      summary: C·∫≠p nh·∫≠t schedule
      operationId: updateMaintenanceSchedule
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MaintenanceScheduleUpdate'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng

    delete:
      tags: [Maintenance]
      summary: X√≥a schedule
      operationId: deleteMaintenanceSchedule
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng

  /maintenance/schedules/device/{deviceId}:
    parameters:
      - name: deviceId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Maintenance]
      summary: L·∫•y schedules theo device
      operationId: getMaintenanceSchedulesByDevice
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch schedules
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MaintenanceSchedule'

  /maintenance/schedules/upcoming:
    get:
      tags: [Maintenance]
      summary: L·∫•y c√°c schedules s·∫Øp t·ªõi
      operationId: getUpcomingMaintenanceSchedules
      security:
        - BearerAuth: []
      parameters:
        - name: days
          in: query
          description: S·ªë ng√†y trong t∆∞∆°ng lai
          schema:
            type: integer
            default: 7
      responses:
        '200':
          description: Upcoming schedules
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MaintenanceSchedule'

  /maintenance/schedules/overdue:
    get:
      tags: [Maintenance]
      summary: L·∫•y c√°c schedules qu√° h·∫°n
      operationId: getOverdueMaintenanceSchedules
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Overdue schedules
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MaintenanceSchedule'

  /maintenance/schedules/{id}/complete:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    post:
      tags: [Maintenance]
      summary: Ho√†n th√†nh schedule
      operationId: completeMaintenanceSchedule
      security:
        - BearerAuth: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                notes:
                  type: string
                cost:
                  type: number
      responses:
        '200':
          description: Completed th√†nh c√¥ng

  /maintenance/records:
    get:
      tags: [Maintenance]
      summary: L·∫•y l·ªãch s·ª≠ b·∫£o tr√¨
      operationId: getMaintenanceRecords
      security:
        - BearerAuth: []
      parameters:
        - name: device_id
          in: query
          schema:
            type: string
            format: uuid
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: L·ªãch s·ª≠ b·∫£o tr√¨
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MaintenanceRecord'

    post:
      tags: [Maintenance]
      summary: T·∫°o maintenance record
      operationId: createMaintenanceRecord
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MaintenanceRecordCreate'
      responses:
        '201':
          description: T·∫°o th√†nh c√¥ng

  /maintenance/records/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Maintenance]
      summary: L·∫•y record theo ID
      operationId: getMaintenanceRecordById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin record
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceRecord'

    put:
      tags: [Maintenance]
      summary: C·∫≠p nh·∫≠t record
      operationId: updateMaintenanceRecord
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MaintenanceRecordUpdate'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng

    delete:
      tags: [Maintenance]
      summary: X√≥a record
      operationId: deleteMaintenanceRecord
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng

  /maintenance/records/device/{deviceId}:
    parameters:
      - name: deviceId
        in: path
        required: true
        schema:
          type: string
          format: uuid
    get:
      tags: [Maintenance]
      summary: L·∫•y records theo device
      operationId: getMaintenanceRecordsByDevice
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch records
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MaintenanceRecord'

  /maintenance/statistics:
    get:
      tags: [Maintenance]
      summary: Th·ªëng k√™ b·∫£o tr√¨
      operationId: getMaintenanceStatistics
      security:
        - BearerAuth: []
      parameters:
        - name: organization_id
          in: query
          schema:
            type: string
            format: uuid
        - name: start_date
          in: query
          schema:
            type: string
            format: date
        - name: end_date
          in: query
          schema:
            type: string
            format: date
      responses:
        '200':
          description: Maintenance statistics
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceStatistics'

  /maintenance/cost-analysis:
    get:
      tags: [Maintenance]
      summary: Ph√¢n t√≠ch chi ph√≠ b·∫£o tr√¨
      operationId: getMaintenanceCostAnalysis
      security:
        - BearerAuth: []
      parameters:
        - name: organization_id
          in: query
          schema:
            type: string
            format: uuid
        - name: year
          in: query
          schema:
            type: integer
        - name: month
          in: query
          schema:
            type: integer
      responses:
        '200':
          description: Cost analysis data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MaintenanceCostAnalysis'

  # ============================================================
  # DEVICE CATEGORIES - FULL CRUD
  # ============================================================
  /devices/categories:
    get:
      tags: [Device Categories]
      summary: L·∫•y danh s√°ch lo·∫°i thi·∫øt b·ªã
      operationId: getDeviceCategories
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch lo·∫°i thi·∫øt b·ªã
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DeviceCategory'

    post:
      tags: [Device Categories]
      summary: T·∫°o lo·∫°i thi·∫øt b·ªã m·ªõi
      operationId: createDeviceCategory
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceCategoryCreate'
      responses:
        '201':
          description: T·∫°o th√†nh c√¥ng

  /devices/categories/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Device Categories]
      summary: L·∫•y category theo ID
      operationId: getDeviceCategoryById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin category
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceCategory'

    put:
      tags: [Device Categories]
      summary: C·∫≠p nh·∫≠t category
      operationId: updateDeviceCategory
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceCategoryUpdate'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng

    delete:
      tags: [Device Categories]
      summary: X√≥a category
      operationId: deleteDeviceCategory
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng

  # ============================================================
  # DEVICE MODELS - FULL CRUD
  # ============================================================
  /devices/models:
    get:
      tags: [Device Models]
      summary: L·∫•y danh s√°ch model thi·∫øt b·ªã
      operationId: getDeviceModels
      security:
        - BearerAuth: []
      parameters:
        - name: category_id
          in: query
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Danh s√°ch models
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DeviceModel'

    post:
      tags: [Device Models]
      summary: T·∫°o model thi·∫øt b·ªã m·ªõi
      operationId: createDeviceModel
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceModelCreate'
      responses:
        '201':
          description: T·∫°o th√†nh c√¥ng

  /devices/models/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [Device Models]
      summary: L·∫•y model theo ID
      operationId: getDeviceModelById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin model
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeviceModel'

    put:
      tags: [Device Models]
      summary: C·∫≠p nh·∫≠t model
      operationId: updateDeviceModel
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeviceModelUpdate'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng

    delete:
      tags: [Device Models]
      summary: X√≥a model
      operationId: deleteDeviceModel
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng

  # ============================================================
  # MQTT & IoT - EXTENDED
  # ============================================================
  /mqtt/devices:
    get:
      tags: [MQTT & IoT]
      summary: L·∫•y danh s√°ch c·∫•u h√¨nh MQTT
      operationId: getMqttDevices
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Danh s√°ch c·∫•u h√¨nh MQTT
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/MqttDevice'

    post:
      tags: [MQTT & IoT]
      summary: T·∫°o k·∫øt n·ªëi MQTT cho thi·∫øt b·ªã
      operationId: createMqttDevice
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MqttDeviceCreate'
      responses:
        '201':
          description: T·∫°o th√†nh c√¥ng

  /mqtt/devices/{id}:
    parameters:
      - $ref: '#/components/parameters/IdPathParam'
    get:
      tags: [MQTT & IoT]
      summary: L·∫•y MQTT device theo ID
      operationId: getMqttDeviceById
      security:
        - BearerAuth: []
      responses:
        '200':
          description: Th√¥ng tin MQTT device
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MqttDevice'

    put:
      tags: [MQTT & IoT]
      summary: C·∫≠p nh·∫≠t MQTT device
      operationId: updateMqttDevice
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MqttDeviceUpdate'
      responses:
        '200':
          description: C·∫≠p nh·∫≠t th√†nh c√¥ng

    delete:
      tags: [MQTT & IoT]
      summary: X√≥a MQTT device
      operationId: deleteMqttDevice
      security:
        - BearerAuth: []
      responses:
        '204':
          description: X√≥a th√†nh c√¥ng

# ============================================================
# COMPONENTS
# ============================================================
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |-
        üîê **JWT Authentication**
        
        ƒê·ªÉ truy c·∫≠p c√°c API endpoints ƒë∆∞·ª£c b·∫£o v·ªá, b·∫°n c·∫ßn:
        1. ƒêƒÉng nh·∫≠p qua `/auth/login` ƒë·ªÉ nh·∫≠n JWT token
        2. Th√™m token v√†o header: `Authorization: Bearer <your-jwt-token>`
        
        **Token c√≥ th·ªùi h·∫°n s·ª≠ d·ª•ng v√† c·∫ßn refresh ƒë·ªãnh k·ª≥.**
        
        **L∆∞u √Ω b·∫£o m·∫≠t:**
        - Kh√¥ng chia s·∫ª token v·ªõi ng∆∞·ªùi kh√°c
        - Kh√¥ng l∆∞u token trong localStorage tr√™n production
        - S·ª≠ d·ª•ng HTTPS ƒë·ªÉ b·∫£o v·ªá token
        
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: |-
        üîë **API Key Authentication** (Alternative)
        
        D√†nh cho:
        - Service-to-service communication
        - Backend integration
        - Automation tools
        
        Contact administrator ƒë·ªÉ nh·∫≠n API Key.
        
    CookieAuth:
      type: apiKey
      in: cookie
      name: access_token
      description: |-
        üç™ **HttpOnly Cookie Authentication**
        
        T·ª± ƒë·ªông s·ª≠ d·ª•ng sau khi ƒëƒÉng nh·∫≠p th√†nh c√¥ng.
        ƒê∆∞·ª£c ∆∞u ti√™n s·ª≠ d·ª•ng tr√™n web applications ƒë·ªÉ tƒÉng b·∫£o m·∫≠t.

  parameters:
    IdPathParam:
      name: id
      in: path
      required: true
      schema:
        type: string
        format: uuid

    PageParam:
      name: page
      in: query
      schema:
        type: integer
        default: 1
        minimum: 1

    LimitParam:
      name: limit
      in: query
      schema:
        type: integer
        default: 20
        minimum: 1
        maximum: 100

  responses:
    UnauthorizedError:
      description: Ch∆∞a x√°c th·ª±c ho·∫∑c token kh√¥ng h·ª£p l·ªá
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    ForbiddenError:
      description: Kh√¥ng c√≥ quy·ªÅn truy c·∫≠p
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

    NotFoundError:
      description: Kh√¥ng t√¨m th·∫•y resource
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'

  schemas:
    # ============================================================
    # COMMON SCHEMAS
    # ============================================================
    Error:
      type: object
      required: [code, message]
      properties:
        code:
          type: string
          example: UNAUTHORIZED
        message:
          type: string
          example: Invalid or expired token

    Pagination:
      type: object
      properties:
        page:
          type: integer
          example: 1
        limit:
          type: integer
          example: 20
        total:
          type: integer
          example: 150
        total_pages:
          type: integer
          example: 8

    # ============================================================
    # AUTHENTICATION
    # ============================================================
    AuthTokens:
      type: object
      properties:
        access_token:
          type: string
        refresh_token:
          type: string
        token_type:
          type: string
          example: Bearer
        expires_in:
          type: integer
          example: 3600

    # ============================================================
    # USERS
    # ============================================================
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        username:
          type: string
        email:
          type: string
          format: email
        full_name:
          type: string
        phone:
          type: string
        role:
          type: string
        organization_id:
          type: string
          format: uuid
        department_id:
          type: string
          format: uuid
        is_active:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UserCreate:
      type: object
      required: [username, password, email, organization_id]
      properties:
        username:
          type: string
        password:
          type: string
          format: password
        email:
          type: string
          format: email
        full_name:
          type: string
        phone:
          type: string
        organization_id:
          type: string
          format: uuid
        department_id:
          type: string
          format: uuid
        role:
          type: string

    UserUpdate:
      type: object
      properties:
        full_name:
          type: string
        email:
          type: string
          format: email
        phone:
          type: string
        department_id:
          type: string
          format: uuid
        is_active:
          type: boolean

    UserListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/User'
        pagination:
          $ref: '#/components/schemas/Pagination'

    # ============================================================
    # ROLES & PERMISSIONS
    # ============================================================
    Role:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        permissions:
          type: array
          items:
            $ref: '#/components/schemas/Permission'
        created_at:
          type: string
          format: date-time

    RoleCreate:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string
        permission_ids:
          type: array
          items:
            type: string
            format: uuid

    RoleUpdate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        permission_ids:
          type: array
          items:
            type: string
            format: uuid

    Permission:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          example: device:read
        description:
          type: string
        resource:
          type: string
          example: device
        action:
          type: string
          example: read

    # ============================================================
    # ORGANIZATIONS
    # ============================================================
    Organization:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        type:
          type: string
          enum: [hospital, clinic, laboratory]
        address:
          type: string
        phone:
          type: string
        email:
          type: string
          format: email
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    OrganizationCreate:
      type: object
      required: [name, type]
      properties:
        name:
          type: string
        type:
          type: string
          enum: [hospital, clinic, laboratory]
        address:
          type: string
        phone:
          type: string
        email:
          type: string
          format: email

    OrganizationUpdate:
      type: object
      properties:
        name:
          type: string
        type:
          type: string
        address:
          type: string
        phone:
          type: string
        email:
          type: string

    OrganizationStatistics:
      type: object
      properties:
        total_devices:
          type: integer
        total_departments:
          type: integer
        total_users:
          type: integer
        active_devices:
          type: integer
        devices_in_maintenance:
          type: integer
        active_alerts:
          type: integer
        monthly_maintenance_cost:
          type: number

    # ============================================================
    # DEPARTMENTS
    # ============================================================
    Department:
      type: object
      properties:
        id:
          type: string
          format: uuid
        organization_id:
          type: string
          format: uuid
        name:
          type: string
        code:
          type: string
        description:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    DepartmentCreate:
      type: object
      required: [organization_id, name, code]
      properties:
        organization_id:
          type: string
          format: uuid
        name:
          type: string
        code:
          type: string
        description:
          type: string

    DepartmentUpdate:
      type: object
      properties:
        name:
          type: string
        code:
          type: string
        description:
          type: string

    DepartmentStatistics:
      type: object
      properties:
        total_devices:
          type: integer
        active_devices:
          type: integer
        total_users:
          type: integer
        active_alerts:
          type: integer
        pending_maintenance:
          type: integer

    # ============================================================
    # DEVICE CATEGORIES
    # ============================================================
    DeviceCategory:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        description:
          type: string
        created_at:
          type: string
          format: date-time

    DeviceCategoryCreate:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string

    DeviceCategoryUpdate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string

    # ============================================================
    # DEVICE MODELS
    # ============================================================
    DeviceModel:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
        model_number:
          type: string
        manufacturer_id:
          type: string
          format: uuid
        category_id:
          type: string
          format: uuid
        specifications:
          type: object
          additionalProperties: true
        warranty_period:
          type: integer
          description: Th·ªùi h·∫°n b·∫£o h√†nh (th√°ng)
        created_at:
          type: string
          format: date-time

    DeviceModelCreate:
      type: object
      required: [name, model_number, category_id]
      properties:
        name:
          type: string
        model_number:
          type: string
        manufacturer_id:
          type: string
          format: uuid
        category_id:
          type: string
          format: uuid
        specifications:
          type: object
        warranty_period:
          type: integer

    DeviceModelUpdate:
      type: object
      properties:
        name:
          type: string
        specifications:
          type: object
        warranty_period:
          type: integer

    # ============================================================
    # DEVICES
    # ============================================================
    Device:
      type: object
      properties:
        id:
          type: string
          format: uuid
        device_code:
          type: string
        serial_number:
          type: string
        model_id:
          type: string
          format: uuid
        organization_id:
          type: string
          format: uuid
        department_id:
          type: string
          format: uuid
        location:
          type: string
        status:
          type: string
          enum: [active, maintenance, retired, inactive]
        purchase_date:
          type: string
          format: date
        warranty_expiry_date:
          type: string
          format: date
        last_maintenance_date:
          type: string
          format: date
        next_maintenance_date:
          type: string
          format: date
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    DeviceCreate:
      type: object
      required: [model_id, serial_number, organization_id]
      properties:
        model_id:
          type: string
          format: uuid
        serial_number:
          type: string
        organization_id:
          type: string
          format: uuid
        department_id:
          type: string
          format: uuid
        location:
          type: string
        purchase_date:
          type: string
          format: date

    DeviceUpdate:
      type: object
      properties:
        department_id:
          type: string
          format: uuid
        location:
          type: string
        status:
          type: string
          enum: [active, maintenance, retired, inactive]

    DeviceListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Device'
        pagination:
          $ref: '#/components/schemas/Pagination'

    DeviceStatistics:
      type: object
      properties:
        total:
          type: integer
        active:
          type: integer
        maintenance:
          type: integer
        retired:
          type: integer
        inactive:
          type: integer
        by_category:
          type: object
          additionalProperties:
            type: integer

    DeviceSummary:
      type: object
      properties:
        device:
          $ref: '#/components/schemas/Device'
        latest_data:
          $ref: '#/components/schemas/SensorData'
        active_alerts:
          type: integer
        maintenance_status:
          type: object
        uptime_percentage:
          type: number

    # ============================================================
    # SENSOR DATA
    # ============================================================
    SensorData:
      type: object
      properties:
        id:
          type: string
          format: uuid
        device_id:
          type: string
          format: uuid
        timestamp:
          type: string
          format: date-time
        data:
          type: object
          additionalProperties: true
        status:
          type: string
          enum: [normal, warning, critical]

    # ============================================================
    # MQTT DEVICES
    # ============================================================
    MqttDevice:
      type: object
      properties:
        id:
          type: string
          format: uuid
        device_id:
          type: string
          format: uuid
        mqtt_user:
          type: string
        mqtt_topic:
          type: string
        broker_host:
          type: string
        broker_port:
          type: integer
        is_active:
          type: boolean
        last_seen:
          type: string
          format: date-time

    MqttDeviceCreate:
      type: object
      required: [device_id, mqtt_user, mqtt_topic, broker_host]
      properties:
        device_id:
          type: string
          format: uuid
        mqtt_user:
          type: string
        mqtt_pass:
          type: string
          format: password
        mqtt_topic:
          type: string
        broker_host:
          type: string
        broker_port:
          type: integer
          default: 1883

    MqttDeviceUpdate:
      type: object
      properties:
        mqtt_topic:
          type: string
        is_active:
          type: boolean

    # ============================================================
    # ALERTS
    # ============================================================
    Alert:
      type: object
      properties:
        id:
          type: string
          format: uuid
        device_id:
          type: string
          format: uuid
        alert_type:
          type: string
          enum: [threshold, offline, maintenance]
        severity:
          type: string
          enum: [low, medium, high, critical]
        message:
          type: string
        status:
          type: string
          enum: [new, acknowledged, resolved]
        acknowledged_by:
          type: string
          format: uuid
        acknowledged_at:
          type: string
          format: date-time
        resolved_by:
          type: string
          format: uuid
        resolved_at:
          type: string
          format: date-time
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    AlertListResponse:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/Alert'
        pagination:
          $ref: '#/components/schemas/Pagination'

    AlertStatistics:
      type: object
      properties:
        total:
          type: integer
        new:
          type: integer
        acknowledged:
          type: integer
        resolved:
          type: integer
        by_severity:
          type: object
          properties:
            low:
              type: integer
            medium:
              type: integer
            high:
              type: integer
            critical:
              type: integer
        by_type:
          type: object
          additionalProperties:
            type: integer

    AlertDashboard:
      type: object
      properties:
        active_count:
          type: integer
        critical_count:
          type: integer
        recent_alerts:
          type: array
          items:
            $ref: '#/components/schemas/Alert'
        trend_data:
          type: object
          additionalProperties: true

    # ============================================================
    # MAINTENANCE
    # ============================================================
    MaintenanceSchedule:
      type: object
      properties:
        id:
          type: string
          format: uuid
        device_id:
          type: string
          format: uuid
        maintenance_type:
          type: string
          enum: [preventive, corrective, calibration]
        scheduled_date:
          type: string
          format: date-time
        frequency:
          type: string
          enum: [daily, weekly, monthly, quarterly, yearly]
        status:
          type: string
          enum: [pending, completed, overdue, cancelled]
        description:
          type: string
        created_by:
          type: string
          format: uuid
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MaintenanceScheduleCreate:
      type: object
      required: [device_id, maintenance_type, scheduled_date]
      properties:
        device_id:
          type: string
          format: uuid
        maintenance_type:
          type: string
          enum: [preventive, corrective, calibration]
        scheduled_date:
          type: string
          format: date-time
        frequency:
          type: string
          enum: [daily, weekly, monthly, quarterly, yearly]
        description:
          type: string

    MaintenanceScheduleUpdate:
      type: object
      properties:
        scheduled_date:
          type: string
          format: date-time
        frequency:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [pending, completed, overdue, cancelled]

    MaintenanceRecord:
      type: object
      properties:
        id:
          type: string
          format: uuid
        device_id:
          type: string
          format: uuid
        schedule_id:
          type: string
          format: uuid
        performed_date:
          type: string
          format: date-time
        maintenance_type:
          type: string
          enum: [preventive, corrective, calibration]
        description:
          type: string
        cost:
          type: number
        technician_id:
          type: string
          format: uuid
        notes:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MaintenanceRecordCreate:
      type: object
      required: [device_id, performed_date, maintenance_type]
      properties:
        device_id:
          type: string
          format: uuid
        schedule_id:
          type: string
          format: uuid
        performed_date:
          type: string
          format: date-time
        maintenance_type:
          type: string
          enum: [preventive, corrective, calibration]
        description:
          type: string
        cost:
          type: number
        technician_id:
          type: string
          format: uuid
        notes:
          type: string

    MaintenanceRecordUpdate:
      type: object
      properties:
        description:
          type: string
        cost:
          type: number
        notes:
          type: string

    MaintenanceStatistics:
      type: object
      properties:
        total_schedules:
          type: integer
        completed:
          type: integer
        pending:
          type: integer
        overdue:
          type: integer
        total_cost:
          type: number
        average_cost:
          type: number
        by_type:
          type: object
          properties:
            preventive:
              type: integer
            corrective:
              type: integer
            calibration:
              type: integer
        monthly_trend:
          type: array
          items:
            type: object
            properties:
              month:
                type: string
              count:
                type: integer
              cost:
                type: number

    MaintenanceCostAnalysis:
      type: object
      properties:
        total_cost:
          type: number
        cost_by_device:
          type: array
          items:
            type: object
            properties:
              device_id:
                type: string
              device_name:
                type: string
              cost:
                type: number
        cost_by_type:
          type: object
          properties:
            preventive:
              type: number
            corrective:
              type: number
            calibration:
              type: number
        cost_by_department:
          type: array
          items:
            type: object
            properties:
              department_id:
                type: string
              department_name:
                type: string
              cost:
                type: number
        monthly_breakdown:
          type: array
          items:
            type: object
            properties:
              month:
                type: string
              total:
                type: number
              by_type:
                type: object
        cost_trend:
          type: array
          items:
            type: object
            properties:
              date:
                type: string
              cost:
                type: number