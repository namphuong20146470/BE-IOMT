generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model device_categories {
  id          String              @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name        String              @db.VarChar(255)
  description String?
  parent_id   String?             @db.Uuid
  parent      device_categories?  @relation("CategoryHierarchy", fields: [parent_id], references: [id], onUpdate: NoAction)
  children    device_categories[] @relation("CategoryHierarchy")
  models      device_models[]

  @@index([parent_id], map: "idx_device_categories_parent")
  @@index([name], map: "idx_device_categories_name")
}

model device_models {
  id              String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  category_id     String            @db.Uuid
  name            String            @db.VarChar(255)
  model_number    String?           @unique(map: "device_models_model_id_key") @db.VarChar(100)
  manufacturer_id String?           @db.Uuid
  supplier_id     String?           @db.Uuid
  created_at      DateTime?         @default(now()) @db.Timestamptz(6)
  specifications  Json?             @default("{}")
  updated_at      DateTime?         @default(now()) @updatedAt @db.Timestamptz(6)
  devices         device[]
  category        device_categories @relation(fields: [category_id], references: [id], onUpdate: NoAction)
  manufacturers   manufacturers?    @relation(fields: [manufacturer_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  suppliers       suppliers?        @relation(fields: [supplier_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([category_id], map: "idx_device_models_category")
  @@index([specifications], map: "idx_device_models_specifications", type: Gin)
}

model device {
  id                    String                  @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  model_id              String                  @db.Uuid
  organization_id       String                  @db.Uuid
  department_id         String?                 @db.Uuid
  serial_number         String                  @unique(map: "idx_device_serial") @db.VarChar(255)
  asset_tag             String?                 @db.VarChar(100)
  status                device_status           @default(active)
  purchase_date         DateTime?               @db.Date
  installation_date     DateTime?               @db.Date
  created_at            DateTime?               @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?               @default(now()) @updatedAt @db.Timestamptz(6)
  location              String?                 @db.VarChar(255)
  notes                 String?
  visibility            device_visibility       @default(private)
  
  // âœ… Soft Delete Fields
  deleted_at            DateTime?               @db.Timestamptz(6)
  deleted_by            String?                 @db.Uuid
  deletion_reason       String?
  
  alert_rules           alert_rules[]
  alert_suppressions    alert_suppressions[]
  alerts                alerts[]
  department            departments?            @relation(fields: [department_id], references: [id], onUpdate: NoAction)
  model                 device_models           @relation(fields: [model_id], references: [id], onUpdate: NoAction)
  organization          organizations           @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  deleted_by_user       users?                  @relation("DeviceDeletedBy", fields: [deleted_by], references: [id], onDelete: SetNull)
  device_data           device_data[]
  device_data_latest    device_data_latest?
  maintenance_history   maintenance_history[]
  maintenance_schedules maintenance_schedules[]
  socket                sockets?
  warranty_info         warranty_info[]

  @@index([model_id], map: "idx_device_model")
  @@index([organization_id], map: "idx_device_organization")
  @@index([department_id], map: "idx_device_department")
  @@index([status], map: "idx_device_status")
  @@index([visibility], map: "idx_device_visibility")
  @@index([organization_id, visibility], map: "idx_device_org_visibility")
  @@index([deleted_at], map: "idx_device_deleted")
  @@index([deleted_by], map: "idx_device_deleted_by")
}

model warranty_info {
  id             String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  device_id      String   @db.Uuid
  warranty_start DateTime @db.Date
  warranty_end   DateTime @db.Date
  provider       String   @db.VarChar(255)
  device         device   @relation(fields: [device_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([device_id], map: "idx_warranty_info_device")
  @@index([warranty_end], map: "idx_warranty_info_end_date")
}

model organizations {
  id                       String                     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                     String                     @db.VarChar(255)
  type                     organization_type
  address                  String?
  phone                    String?                    @db.VarChar(20)
  email                    String?                    @db.VarChar(255)
  license_number           String?                    @db.VarChar(100)
  created_at               DateTime?                  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime?                  @default(now()) @updatedAt @db.Timestamptz(6)
  is_active                Boolean                    @default(true)
  code                     String?                    @db.VarChar(50)
  website                  String?                    @db.VarChar(255)
  description              String?
  status                   org_status?                @default(ACTIVE)
  access_policies          access_policies[]
  alert_metrics            alert_metrics[]
  alert_rules              alert_rules[]
  alert_suppressions       alert_suppressions[]
  audit_logs               audit_logs[]
  dashboards               dashboards[]
  departments              departments[]
  devices                  device[]
  maintenance_history      maintenance_history[]
  organization_settings    organization_settings?
  power_distribution_units power_distribution_units[]
  reports                  reports[]
  roles                    roles[]
  system_settings          system_settings[]
  user_roles               user_roles[]
  users                    users[]

  @@index([is_active], map: "idx_organizations_active")
  @@index([name], map: "idx_organizations_name")
  @@index([type], map: "idx_organizations_type")
}

model departments {
  id                       String                     @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organization_id          String                     @db.Uuid
  name                     String                     @db.VarChar(255)
  description              String?
  code                     String?                    @db.VarChar(20)
  created_at               DateTime?                  @default(now()) @db.Timestamptz(6)
  updated_at               DateTime?                  @default(now()) @updatedAt @db.Timestamptz(6)
  organization             organizations              @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  devices                  device[]
  maintenance_history      maintenance_history[]
  power_distribution_units power_distribution_units[]
  user_roles               user_roles[]
  users                    users[]

  @@index([code], map: "idx_departments_code")
  @@index([organization_id], map: "idx_departments_organization")
}

model iot_environment_status {
  id               Int       @id @default(autoincrement())
  leak_current_ma  Float?    @db.Real
  temperature_c    Float?    @db.Real
  humidity_percent Float?    @db.Real
  over_temperature Boolean?  @default(false)
  over_humidity    Boolean?  @default(false)
  soft_warning     Boolean?  @default(false)
  strong_warning   Boolean?  @default(false)
  shutdown_warning Boolean?  @default(false)
  timestamp        DateTime? @default(now()) @db.Timestamp(6)
}

model device_warning_logs {
  id                    Int                     @id @default(autoincrement())
  device_type           String
  device_name           String?
  device_id             Int?
  warning_type          String
  warning_severity      String
  measured_value        Float?
  threshold_value       Float?
  warning_message       String
  status                String                  @default("active")
  resolved_at           DateTime?
  acknowledged_by       Int?
  resolution_notes      String?
  timestamp             DateTime                @default(now()) @db.Timestamp(6)
  acknowledged_by_user  users_backup?           @relation("DeviceWarningLogAcknowledgedBy", fields: [acknowledged_by], references: [id])
  warning_notifications warning_notifications[]

  @@index([device_type, timestamp])
  @@index([warning_type, timestamp])
  @@index([status, timestamp])
}

model logs {
  id              Int           @id @default(autoincrement())
  user_id         Int?
  action          String        @db.VarChar(50)
  target          String?       @db.VarChar(100)
  details         String?
  created_at      DateTime?     @default(now()) @db.Timestamp(6)
  created_by_user users_backup? @relation("LogCreatedBy", fields: [user_id], references: [id])
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model alert_assignments {
  id                                         String            @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  alert_id                                   String            @db.Uuid
  user_id                                    String            @db.Uuid
  assigned_by                                String?           @db.Uuid
  role                                       assignment_role   @default(assignee)
  escalation_level                           escalation_level? @default(L1)
  priority                                   Int?              @default(1)
  auto_escalate_minutes                      Int?              @default(30)
  assigned_at                                DateTime?         @default(now()) @db.Timestamptz(6)
  acknowledged_at                            DateTime?         @db.Timestamptz(6)
  completed_at                               DateTime?         @db.Timestamptz(6)
  notes                                      String?
  alerts                                     alerts            @relation(fields: [alert_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_alert_assignments_assigned_byTousers users?            @relation("alert_assignments_assigned_byTousers", fields: [assigned_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users_alert_assignments_user_idTousers     users             @relation("alert_assignments_user_idTousers", fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([alert_id], map: "idx_alert_assignments_alert")
  @@index([escalation_level], map: "idx_alert_assignments_escalation")
  @@index([role], map: "idx_alert_assignments_role")
  @@index([user_id], map: "idx_alert_assignments_user")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model alert_metrics {
  id                              String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organization_id                 String        @db.Uuid
  date                            DateTime      @db.Date
  total_alerts                    Int?          @default(0)
  critical_alerts                 Int?          @default(0)
  high_alerts                     Int?          @default(0)
  medium_alerts                   Int?          @default(0)
  low_alerts                      Int?          @default(0)
  resolved_alerts                 Int?          @default(0)
  average_resolution_time_minutes Int?          @default(0)
  false_positive_rate             Decimal?      @default(0.00) @db.Decimal(5, 2)
  created_at                      DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at                      DateTime?     @default(now()) @db.Timestamptz(6)
  organizations                   organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([organization_id, date])
  @@index([date(sort: Desc)], map: "idx_alert_metrics_date")
  @@index([organization_id, date(sort: Desc)], map: "idx_alert_metrics_org_date")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model alert_rules {
  id                 String               @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organization_id    String               @db.Uuid
  device_id          String?              @db.Uuid
  measurement_id     String               @db.Uuid
  name               String               @db.VarChar(255)
  description        String?
  condition          condition_type
  threshold_value    Float?
  threshold_min      Float?
  threshold_max      Float?
  severity           alert_severity       @default(medium)
  is_active          Boolean              @default(true)
  cooldown_minutes   Int?                 @default(15)
  created_by         String               @db.Uuid
  created_at         DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?            @default(now()) @db.Timestamptz(6)
  users              users                @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  device             device?              @relation(fields: [device_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  measurements       measurements         @relation(fields: [measurement_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  organizations      organizations        @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  alert_suppressions alert_suppressions[]
  alerts             alerts[]

  @@index([is_active], map: "idx_alert_rules_active")
  @@index([device_id], map: "idx_alert_rules_device")
  @@index([measurement_id], map: "idx_alert_rules_measurement")
  @@index([organization_id], map: "idx_alert_rules_organization")
  @@index([severity], map: "idx_alert_rules_severity")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model alert_suppressions {
  id              String           @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organization_id String           @db.Uuid
  device_id       String?          @db.Uuid
  measurement_id  String?          @db.Uuid
  rule_id         String?          @db.Uuid
  type            suppression_type @default(manual)
  reason          String
  start_time      DateTime         @default(now()) @db.Timestamptz(6)
  end_time        DateTime?        @db.Timestamptz(6)
  created_by      String           @db.Uuid
  is_active       Boolean          @default(true)
  created_at      DateTime?        @default(now()) @db.Timestamptz(6)
  users           users            @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  device          device?          @relation(fields: [device_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  measurements    measurements?    @relation(fields: [measurement_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  organizations   organizations    @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  alert_rules     alert_rules?     @relation(fields: [rule_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([is_active], map: "idx_alert_suppressions_active")
  @@index([device_id], map: "idx_alert_suppressions_device")
  @@index([organization_id], map: "idx_alert_suppressions_org")
  @@index([rule_id], map: "idx_alert_suppressions_rule")
  @@index([start_time, end_time], map: "idx_alert_suppressions_time")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model alerts {
  id                                  String              @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  device_id                           String              @db.Uuid
  measurement_id                      String              @db.Uuid
  rule_id                             String              @db.Uuid
  device_data_id                      String?             @db.Uuid
  severity                            alert_severity
  status                              alert_status        @default(active)
  title                               String              @db.VarChar(255)
  message                             String
  current_value                       Float?
  threshold_info                      Json?
  triggered_at                        DateTime            @default(now()) @db.Timestamptz(6)
  acknowledged_at                     DateTime?           @db.Timestamptz(6)
  acknowledged_by                     String?             @db.Uuid
  resolved_at                         DateTime?           @db.Timestamptz(6)
  resolved_by                         String?             @db.Uuid
  resolution_notes                    String?
  alert_assignments                   alert_assignments[]
  users_alerts_acknowledged_byTousers users?              @relation("alerts_acknowledged_byTousers", fields: [acknowledged_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  device_data                         device_data?        @relation(fields: [device_data_id], references: [id], onUpdate: NoAction)
  device                              device              @relation(fields: [device_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  measurements                        measurements        @relation(fields: [measurement_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users_alerts_resolved_byTousers     users?              @relation("alerts_resolved_byTousers", fields: [resolved_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  alert_rules                         alert_rules         @relation(fields: [rule_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  notification_logs                   notification_logs[]

  @@index([device_id], map: "idx_alerts_device")
  @@index([measurement_id], map: "idx_alerts_measurement")
  @@index([rule_id], map: "idx_alerts_rule")
  @@index([severity], map: "idx_alerts_severity")
  @@index([status], map: "idx_alerts_status")
  @@index([triggered_at(sort: Desc)], map: "idx_alerts_triggered_at")
}

model dashboards {
  id              String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organization_id String        @db.Uuid
  name            String        @db.VarChar(255)
  layout_config   String?
  widget_config   String?
  organizations   organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([organization_id], map: "idx_dashboards_organization")
}

model data_values {
  id             String      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  device_data_id String      @db.Uuid
  value_numeric  Float?
  value_text     String?
  recorded_at    DateTime    @default(now()) @db.Timestamptz(6)
  device_data    device_data @relation(fields: [device_data_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([device_data_id], map: "idx_data_values_device_data")
  @@index([recorded_at(sort: Desc)], map: "idx_data_values_recorded_at")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model device_data {
  id            String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  device_id     String        @db.Uuid
  timestamp     DateTime      @default(now()) @db.Timestamptz(6)
  socket_id     String?       @db.Uuid
  created_at    DateTime      @default(now()) @db.Timestamptz(6)
  current       Float?        @db.Real
  frequency     Float?        @db.Real
  machine_state Boolean?      @default(false)
  over_voltage  Boolean?      @default(false)
  power         Float?        @db.Real
  power_factor  Float?        @db.Real
  sensor_state  Boolean?      @default(false)
  socket_state  Boolean?      @default(false)
  under_voltage Boolean?      @default(false)
  voltage       Float?        @db.Real
  alerts        alerts[]
  data_values   data_values[]
  device        device        @relation(fields: [device_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  socket        sockets?      @relation(fields: [socket_id], references: [id], map: "device_data_socket_id_fkey")

  @@index([device_id, timestamp(sort: Desc)], map: "idx_device_data_device_time")
  @@index([socket_id, timestamp(sort: Desc)], map: "idx_device_data_socket_time")
  @@index([timestamp(sort: Desc)], map: "idx_device_data_timestamp")
  @@index([device_id, created_at(sort: Desc)], map: "idx_device_data_device_created")
}

model maintenance_schedules {
  id                     String                @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  device_id              String                @db.Uuid
  schedule_type          maintenance_type
  due_date               DateTime              @db.Date
  status                 schedule_status       @default(pending)
  maintenance_history_id String?               @db.Uuid
  maintenance_history    maintenance_history[]
  device                 device                @relation(fields: [device_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([device_id], map: "idx_maintenance_schedules_device")
  @@index([due_date], map: "idx_maintenance_schedules_due_date")
  @@index([status], map: "idx_maintenance_schedules_status")
}

model measurements {
  id                 String                @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name               String                @unique @db.VarChar(100)
  unit               String?               @db.VarChar(20)
  data_type          measurement_data_type @default(numeric)
  validation_rules   String?
  alert_rules        alert_rules[]
  alert_suppressions alert_suppressions[]
  alerts             alerts[]

  @@index([data_type], map: "idx_measurements_data_type")
  @@index([name], map: "idx_measurements_name")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model notification_logs {
  id            String               @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  alert_id      String               @db.Uuid
  user_id       String?              @db.Uuid
  channel       notification_channel
  recipient     String               @db.VarChar(255)
  status        notification_status  @default(pending)
  attempt_count Int?                 @default(1)
  max_attempts  Int?                 @default(3)
  error_message String?
  response_data Json?
  sent_at       DateTime?            @db.Timestamptz(6)
  created_at    DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at    DateTime?            @default(now()) @db.Timestamptz(6)
  alerts        alerts               @relation(fields: [alert_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users         users?               @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([alert_id], map: "idx_notification_logs_alert")
  @@index([channel], map: "idx_notification_logs_channel")
  @@index([created_at(sort: Desc)], map: "idx_notification_logs_created_at")
  @@index([status], map: "idx_notification_logs_status")
  @@index([user_id], map: "idx_notification_logs_user")
}

model reports {
  id              String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organization_id String        @db.Uuid
  name            String        @db.VarChar(255)
  query_config    String
  output_format   report_format @default(pdf)
  generated_at    DateTime?     @default(now()) @db.Timestamptz(6)
  organizations   organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([generated_at(sort: Desc)], map: "idx_reports_generated_at")
  @@index([organization_id], map: "idx_reports_organization")
}

model system_settings {
  id              String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organization_id String?        @db.Uuid
  key             String         @db.VarChar(255)
  value           String?
  organizations   organizations? @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([organization_id, key])
  @@index([key], map: "idx_system_settings_key")
  @@index([organization_id], map: "idx_system_settings_organization")
}

model users {
  id                                                     String                     @id(map: "users_v2_pkey") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organization_id                                        String?                    @db.Uuid
  department_id                                          String?                    @db.Uuid
  username                                               String                     @unique(map: "users_v2_username_key") @db.VarChar(50)
  password_hash                                          String                     @db.VarChar(255)
  full_name                                              String                     @db.VarChar(255)
  email                                                  String?                    @unique(map: "idx_users_v2_email") @db.VarChar(255)
  phone                                                  String?                    @db.VarChar(20)
  is_active                                              Boolean                    @default(true)
  created_at                                             DateTime?                  @default(now()) @db.Timestamptz(6)
  updated_at                                             DateTime?                  @default(now()) @db.Timestamptz(6)
  access_policies                                        access_policies[]
  alert_assignments_alert_assignments_assigned_byTousers alert_assignments[]        @relation("alert_assignments_assigned_byTousers")
  alert_assignments_alert_assignments_user_idTousers     alert_assignments[]        @relation("alert_assignments_user_idTousers")
  alert_rules                                            alert_rules[]
  alert_suppressions                                     alert_suppressions[]
  alerts_alerts_acknowledged_byTousers                   alerts[]                   @relation("alerts_acknowledged_byTousers")
  alerts_alerts_resolved_byTousers                       alerts[]                   @relation("alerts_resolved_byTousers")
  audit_logs                                             audit_logs[]
  maintenance_created                                    maintenance_history[]      @relation("MaintenanceCreator")
  maintenance_performed                                  maintenance_history[]      @relation("MaintenancePerformer")
  notification_logs                                      notification_logs[]
  pdu_created                                            power_distribution_units[] @relation("PDUCreator")
  resource_access                                        resource_access[]
  role_templates                                         role_templates[]
  roles_created                                          roles[]
  socket_assignments                                     sockets[]                  @relation("SocketAssignedBy")
  user_permission_cache                                  user_permission_cache?
  user_permissions_granted                               user_permissions[]         @relation("UserPermissionGrantedBy")
  user_permissions                                       user_permissions[]
  user_roles_assigned                                    user_roles[]               @relation("UserRoleAssignedBy")
  user_roles                                             user_roles[]
  user_sessions                                          user_sessions[]
  devices_deleted                                        device[]                   @relation("DeviceDeletedBy")
  departments                                            departments?               @relation(fields: [department_id], references: [id], onUpdate: NoAction, map: "users_v2_department_id_fkey")
  organizations                                          organizations?             @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "users_v2_organization_id_fkey")

  @@index([is_active], map: "idx_users_v2_active")
  @@index([department_id], map: "idx_users_v2_department")
  @@index([full_name], map: "idx_users_v2_full_name")
  @@index([organization_id], map: "idx_users_v2_organization")
}

model warning_notifications {
  id                  Int                 @id @default(autoincrement())
  warning_id          Int
  send_time           DateTime            @default(now()) @db.Timestamp(6)
  level               Int
  device_warning_logs device_warning_logs @relation(fields: [warning_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model user_sessions {
  id            String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id       String    @db.Uuid
  access_token  String    @unique(map: "user_sessions_session_token_key") @db.VarChar(255)
  refresh_token String?   @db.VarChar(255)
  device_info   String?
  ip_address    String?   @db.Inet
  expires_at    DateTime  @db.Timestamptz(6)
  created_at    DateTime? @default(now()) @db.Timestamptz(6)
  last_activity DateTime? @default(now()) @db.Timestamptz(6)
  is_active     Boolean   @default(true)
  users         users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([user_id], map: "idx_user_sessions_user")
  @@index([is_active], map: "idx_user_sessions_active")
  @@index([expires_at], map: "idx_user_sessions_expires")
  @@index([last_activity], map: "idx_user_sessions_last_activity")
  @@index([access_token], map: "idx_user_sessions_access_token")
}

model audit_logs {
  id              String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id         String?        @db.Uuid
  organization_id String?        @db.Uuid
  action          audit_action
  resource_type   String?        @db.VarChar(50)
  resource_id     String?        @db.Uuid
  old_values      Json?
  new_values      Json?
  ip_address      String?        @db.Inet
  user_agent      String?
  success         Boolean?       @default(true)
  error_message   String?
  created_at      DateTime?      @default(now()) @db.Timestamptz(6)
  organizations   organizations? @relation(fields: [organization_id], references: [id], onUpdate: NoAction)
  users           users?         @relation(fields: [user_id], references: [id], onUpdate: NoAction)

  @@index([user_id], map: "idx_audit_logs_user")
  @@index([organization_id], map: "idx_audit_logs_org")
  @@index([action], map: "idx_audit_logs_action")
  @@index([resource_type, resource_id], map: "idx_audit_logs_resource")
  @@index([created_at], map: "idx_audit_logs_created")
  @@index([success], map: "idx_audit_logs_success")
}

model permission_groups {
  id          String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name        String        @unique @db.VarChar(100)
  description String?
  color       String?       @db.VarChar(7)
  icon        String?       @db.VarChar(50)
  sort_order  Int?          @default(0)
  is_active   Boolean       @default(true)
  created_at  DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at  DateTime?     @default(now()) @updatedAt @db.Timestamptz(6)
  permissions permissions[]

  @@index([is_active], map: "idx_permission_groups_active")
  @@index([sort_order], map: "idx_permission_groups_sort")
}

model permissions {
  id                String             @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name              String             @unique @db.VarChar(100)
  description       String?
  resource          String             @db.VarChar(50)
  action            String             @db.VarChar(50)
  group_id          String?            @db.Uuid
  depends_on        String[]           @db.Uuid
  conditions        Json?              @default("{}")
  priority          Int?               @default(0)
  is_active         Boolean?           @default(true)
  created_at        DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?          @default(now()) @updatedAt @db.Timestamptz(6)
  parent_id         String?            @db.Uuid
  scope             String?            @default("global") @db.VarChar(20)
  permission_groups permission_groups? @relation(fields: [group_id], references: [id], onUpdate: NoAction)
  permissions       permissions?       @relation("permissionsTopermissions", fields: [parent_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  other_permissions permissions[]      @relation("permissionsTopermissions")
  role_permissions  role_permissions[]
  user_permissions  user_permissions[]

  @@index([group_id], map: "idx_permissions_group")
  @@index([is_active], map: "idx_permissions_active")
  @@index([priority], map: "idx_permissions_priority")
  @@index([name], map: "idx_permissions_name")
  @@index([parent_id], map: "idx_permissions_parent_id")
  @@index([resource, action], map: "idx_permissions_resource_action")
  @@index([resource, is_active], map: "idx_permissions_resource_active")
  @@index([scope], map: "idx_permissions_scope")
  @@index([scope, resource], map: "idx_permissions_scope_resource")
}

model roles {
  id                    String             @id(map: "roles_pkey1") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                  String             @unique(map: "roles_name_key1") @db.VarChar(100)
  description           String?
  is_system_role        Boolean            @default(false)
  organization_id       String?            @db.Uuid
  is_custom             Boolean?           @default(true)
  color                 String?            @db.VarChar(7)
  icon                  String?            @db.VarChar(50)
  sort_order            Int?               @default(0)
  is_active             Boolean?           @default(true)
  created_by            String?            @db.Uuid
  created_at            DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?          @default(now()) @updatedAt @db.Timestamptz(6)
  role_hierarchy_child  role_hierarchy[]   @relation("RoleHierarchyChild")
  role_hierarchy_parent role_hierarchy[]   @relation("RoleHierarchyParent")
  role_permissions      role_permissions[]
  users                 users?             @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  organizations         organizations?     @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  user_roles            user_roles[]

  @@index([organization_id], map: "idx_roles_organization")
  @@index([is_custom], map: "idx_roles_custom")
  @@index([is_active], map: "idx_roles_active")
  @@index([sort_order], map: "idx_roles_sort")
  @@index([is_system_role], map: "idx_roles_system")
}

model role_permissions {
  id            String      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  role_id       String      @db.Uuid
  permission_id String      @db.Uuid
  permissions   permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  roles         roles       @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([role_id, permission_id])
  @@index([role_id], map: "idx_role_permissions_role")
  @@index([permission_id], map: "idx_role_permissions_permission")
}

model user_roles {
  id               String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id          String         @db.Uuid
  role_id          String         @db.Uuid
  organization_id  String?        @db.Uuid
  department_id    String?        @db.Uuid
  valid_from       DateTime?      @default(now()) @db.Timestamptz(6)
  valid_until      DateTime?      @db.Timestamptz(6)
  assigned_by      String?        @db.Uuid
  assigned_at      DateTime?      @default(now()) @db.Timestamptz(6)
  is_active        Boolean?       @default(true)
  notes            String?
  assigned_by_user users?         @relation("UserRoleAssignedBy", fields: [assigned_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  departments      departments?   @relation(fields: [department_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  organizations    organizations? @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  roles            roles          @relation(fields: [role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users            users          @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, role_id, organization_id, department_id])
  @@index([user_id], map: "idx_user_roles_user")
  @@index([role_id], map: "idx_user_roles_role")
  @@index([organization_id], map: "idx_user_roles_organization")
  @@index([department_id], map: "idx_user_roles_department")
  @@index([valid_from, valid_until], map: "idx_user_roles_validity")
  @@index([assigned_by], map: "idx_user_roles_assigned")
  @@index([is_active], map: "idx_user_roles_active")
}

model user_permissions {
  id              String      @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id         String      @db.Uuid
  permission_id   String      @db.Uuid
  granted_by      String?     @db.Uuid
  granted_at      DateTime?   @default(now()) @db.Timestamptz(6)
  valid_from      DateTime?   @default(now()) @db.Timestamptz(6)
  valid_until     DateTime?   @db.Timestamptz(6)
  is_active       Boolean?    @default(true)
  notes           String?
  granted_by_user users?      @relation("UserPermissionGrantedBy", fields: [granted_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  permissions     permissions @relation(fields: [permission_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users           users       @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, permission_id])
  @@index([user_id], map: "idx_user_permissions_user")
  @@index([permission_id], map: "idx_user_permissions_permission")
  @@index([granted_by], map: "idx_user_permissions_granted")
  @@index([valid_from, valid_until], map: "idx_user_permissions_validity")
  @@index([is_active], map: "idx_user_permissions_active")
}

model role_hierarchy {
  id             String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  parent_role_id String    @db.Uuid
  child_role_id  String    @db.Uuid
  created_at     DateTime? @default(now()) @db.Timestamptz(6)
  child_role     roles     @relation("RoleHierarchyChild", fields: [child_role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  parent_role    roles     @relation("RoleHierarchyParent", fields: [parent_role_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([parent_role_id, child_role_id])
  @@index([parent_role_id], map: "idx_role_hierarchy_parent")
  @@index([child_role_id], map: "idx_role_hierarchy_child")
}

model organization_settings {
  id                      String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organization_id         String        @unique @db.Uuid
  max_users               Int?          @default(1000)
  session_timeout_minutes Int?          @default(480)
  password_policy         Json?         @default("{\"min_length\": 8, \"max_age_days\": 90, \"require_numbers\": true, \"require_special\": false, \"require_lowercase\": true, \"require_uppercase\": true}")
  allowed_permissions     String[]
  two_factor_required     Boolean?      @default(false)
  ip_whitelist            String[]      @db.Inet
  settings                Json?         @default("{}")
  created_at              DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at              DateTime?     @default(now()) @updatedAt @db.Timestamptz(6)
  organizations           organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model role_templates {
  id                 String              @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name               String              @db.VarChar(100)
  description        String?
  organization_types organization_type[]
  permission_ids     String[]            @db.Uuid
  is_default         Boolean?            @default(false)
  is_active          Boolean?            @default(true)
  created_by         String?             @db.Uuid
  created_at         DateTime?           @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?           @default(now()) @updatedAt @db.Timestamptz(6)
  users              users?              @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@index([is_active], map: "idx_role_templates_active")
  @@index([is_default], map: "idx_role_templates_default")
  @@index([created_by], map: "idx_role_templates_created_by")
}

model resource_access {
  id            String       @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id       String       @db.Uuid
  resource_type String       @db.VarChar(50)
  resource_id   String       @db.Uuid
  access_level  access_level @default(read)
  users         users        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, resource_type, resource_id], map: "idx_resource_access_unique")
  @@index([user_id], map: "idx_resource_access_user")
  @@index([resource_type, resource_id], map: "idx_resource_access_resource")
}

model access_policies {
  id                  String         @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name                String         @db.VarChar(100)
  description         String?
  organization_id     String?        @db.Uuid
  conditions          Json           @default("{}")
  permission_ids      String[]       @db.Uuid
  deny_permission_ids String[]       @db.Uuid
  is_active           Boolean?       @default(true)
  priority            Int?           @default(0)
  valid_from          DateTime?      @default(now()) @db.Timestamptz(6)
  valid_until         DateTime?      @db.Timestamptz(6)
  created_by          String?        @db.Uuid
  created_at          DateTime?      @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?      @default(now()) @db.Timestamptz(6)
  users               users?         @relation(fields: [created_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  organizations       organizations? @relation(fields: [organization_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([is_active], map: "idx_access_policies_active")
  @@index([organization_id], map: "idx_access_policies_org")
  @@index([priority], map: "idx_access_policies_priority")
  @@index([valid_from, valid_until], map: "idx_access_policies_validity")
}

model manufacturers {
  id            String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name          String          @unique @db.VarChar(255)
  country       String?         @db.VarChar(100)
  website       String?         @db.VarChar(255)
  contact_info  Json?
  device_models device_models[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model roles_backup {
  id           Int            @id(map: "roles_pkey") @default(autoincrement())
  name         String         @unique(map: "roles_name_key") @db.VarChar(50)
  description  String?
  id_role      String?        @unique(map: "unique_id_role") @db.VarChar(20)
  users_backup users_backup[]
}

model suppliers {
  id            String          @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  name          String          @unique @db.VarChar(255)
  country       String?         @db.VarChar(100)
  website       String?         @db.VarChar(255)
  contact_info  Json?
  device_models device_models[]
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model users_backup {
  id                               Int                   @id(map: "users_pkey") @default(autoincrement())
  username                         String                @unique(map: "users_username_key") @db.VarChar(50)
  password_hash                    String
  full_name                        String?               @db.VarChar(100)
  role_id                          Int?
  is_active                        Boolean?              @default(true)
  device_warning_logs_acknowledged device_warning_logs[] @relation("DeviceWarningLogAcknowledgedBy")
  logs_created                     logs[]                @relation("LogCreatedBy")
  roles_backup                     roles_backup?         @relation(fields: [role_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "users_role_id_fkey")
}

model device_data_logs {
  id        String    @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  device_id String    @db.Uuid
  data_json Json
  timestamp DateTime? @default(now()) @db.Timestamptz(6)
  socket_id String?   @db.Uuid
  socket    sockets?  @relation(fields: [socket_id], references: [id], map: "device_data_logs_outlet_id_fkey")

  @@index([device_id], map: "idx_device_data_logs_device")
  @@index([socket_id, timestamp(sort: Desc)], map: "idx_device_data_logs_socket_time")
  @@index([timestamp], map: "idx_device_data_logs_timestamp")
}

/// Permission cache table for performance optimization
model user_permission_cache {
  id          String   @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  user_id     String   @unique(map: "uq_user_permission_cache_user") @db.Uuid
  permissions Json     @default("[]") @db.Json
  computed_at DateTime @default(now()) @db.Timestamptz(6)
  expires_at  DateTime @db.Timestamptz(6)
  users       users    @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_permission_cache_user")

  @@index([user_id], map: "idx_user_permission_cache_user")
  @@index([expires_at], map: "idx_user_permission_cache_expires")
}

/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model maintenance_history {
  id                    String                 @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  device_id             String                 @db.Uuid
  schedule_id           String?                @db.Uuid
  maintenance_type      maintenance_type
  title                 String                 @db.VarChar(255)
  description           String?
  performed_date        DateTime               @db.Timestamptz(6)
  duration_minutes      Int?
  performed_by          String?                @db.Uuid
  technician_name       String?                @db.VarChar(255)
  department_id         String?                @db.Uuid
  cost                  Decimal?               @db.Decimal(12, 2)
  currency              String?                @default("VND") @db.VarChar(3)
  parts_replaced        Json?                  @default("[]")
  consumables_used      Json?                  @default("[]")
  status                maintenance_status     @default(completed)
  severity              maintenance_severity   @default(routine)
  issues_found          String?
  actions_taken         String?
  recommendations       String?
  device_condition      device_condition?
  performance_rating    Int?                   @db.SmallInt
  next_maintenance_date DateTime?              @db.Date
  next_maintenance_type maintenance_type?
  attachments           Json?                  @default("[]")
  photos                Json?                  @default("[]")
  created_at            DateTime?              @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?              @default(now()) @updatedAt @db.Timestamptz(6)
  created_by            String?                @db.Uuid
  organization_id       String                 @db.Uuid
  customer_issue        String?
  technician_issue      String?
  conclusion            String?
  root_cause            String?
  ticket_number         String?                @db.VarChar(50)
  socket_id             String?                @db.Uuid
  start_time            DateTime?              @db.Timestamptz(6)
  end_time              DateTime?              @db.Timestamptz(6)
  initial_metrics       Json?                  @default("{}")
  final_metrics         Json?                  @default("{}")
  creator               users?                 @relation("MaintenanceCreator", fields: [created_by], references: [id])
  department            departments?           @relation(fields: [department_id], references: [id])
  device                device                 @relation(fields: [device_id], references: [id], onDelete: Cascade)
  organization          organizations          @relation(fields: [organization_id], references: [id])
  performer             users?                 @relation("MaintenancePerformer", fields: [performed_by], references: [id])
  schedule              maintenance_schedules? @relation(fields: [schedule_id], references: [id])
  sockets               sockets?               @relation(fields: [socket_id], references: [id], onUpdate: NoAction)
  maintenance_jobs      maintenance_jobs[]
  parts                 maintenance_parts[]

  @@index([device_id], map: "idx_maintenance_history_device")
  @@index([performed_date(sort: Desc)], map: "idx_maintenance_history_date")
  @@index([organization_id], map: "idx_maintenance_history_org")
  @@index([maintenance_type], map: "idx_maintenance_history_type")
  @@index([status], map: "idx_maintenance_history_status")
  @@index([performed_by], map: "idx_maintenance_history_performer")
  @@index([device_id, performed_date(sort: Desc)], map: "idx_maintenance_device_date")
  @@index([socket_id], map: "idx_maintenance_socket")
  @@index([start_time, end_time], map: "idx_maintenance_time_range")
  @@index([final_metrics], map: "idx_maintenance_history_final_metrics", type: Gin)
  @@index([initial_metrics], map: "idx_maintenance_history_initial_metrics", type: Gin)
}

model maintenance_parts {
  id              String              @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  maintenance_id  String              @db.Uuid
  part_name       String              @db.VarChar(255)
  part_number     String?             @db.VarChar(100)
  quantity        Int                 @default(1)
  unit_price      Decimal?            @db.Decimal(12, 2)
  total_cost      Decimal?            @db.Decimal(12, 2)
  supplier        String?             @db.VarChar(255)
  warranty_months Int?
  created_at      DateTime?           @default(now()) @db.Timestamptz(6)
  maintenance     maintenance_history @relation(fields: [maintenance_id], references: [id], onDelete: Cascade)

  @@index([maintenance_id], map: "idx_maintenance_parts_maintenance")
}

/// PDU & Socket System Models
model power_distribution_units {
  id              String        @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  organization_id String        @db.Uuid
  department_id   String?       @db.Uuid
  name            String        @db.VarChar(100)
  code            String?       @db.VarChar(50)
  type            pdu_type      @default(cart)
  description     String?       @db.VarChar(255)
  location        String?       @db.VarChar(255)
  floor           String?       @db.VarChar(50)
  building        String?       @db.VarChar(100)
  total_sockets   Int           @default(4)
  max_power_watts Float?        @default(10000) @db.Real
  voltage_rating  Float?        @default(220) @db.Real
  mqtt_base_topic String?       @db.VarChar(255)
  manufacturer    String?       @db.VarChar(100)
  model_number    String?       @db.VarChar(100)
  serial_number   String?       @db.VarChar(100)
  is_mobile       Boolean       @default(true)
  is_active       Boolean       @default(true)
  specifications  Json?         @default("{}")
  created_at      DateTime?     @default(now()) @db.Timestamptz(6)
  updated_at      DateTime?     @default(now()) @updatedAt @db.Timestamptz(6)
  created_by      String?       @db.Uuid
  creator         users?        @relation("PDUCreator", fields: [created_by], references: [id])
  department      departments?  @relation(fields: [department_id], references: [id], onDelete: Cascade)
  organization    organizations @relation(fields: [organization_id], references: [id], onDelete: Cascade)
  sockets         sockets[]

  @@unique([organization_id, code], map: "unique_org_pdu_code")
  @@index([organization_id], map: "idx_pdu_org")
  @@index([department_id], map: "idx_pdu_dept")
  @@index([type], map: "idx_pdu_type")
  @@index([is_active], map: "idx_pdu_active")
  @@index([location], map: "idx_pdu_location")
}

model sockets {
  id                  String                   @id(map: "outlets_pkey") @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  pdu_id              String                   @db.Uuid
  socket_number       Int
  name                String?                  @db.VarChar(100)
  description         String?                  @db.VarChar(255)
  mqtt_topic_suffix   String                   @db.VarChar(100)
  max_power_watts     Float?                   @default(3000) @db.Real
  socket_type         String?                  @db.VarChar(50)
  device_id           String?                  @unique(map: "outlets_device_id_key") @db.Uuid
  assigned_at         DateTime?                @db.Timestamptz(6)
  assigned_by         String?                  @db.Uuid
  status              socket_status            @default(inactive)
  is_enabled          Boolean                  @default(true)
  display_order       Int?                     @default(1)
  notes               String?                  @db.VarChar(500)
  created_at          DateTime?                @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?                @default(now()) @updatedAt @db.Timestamptz(6)
  mqtt_broker_host    String?                  @db.VarChar(255)
  mqtt_broker_port    Int?                     @default(1883)
  mqtt_credentials    Json?                    @default("{}")
  mqtt_config         Json?                    @default("{}")
  device_data         device_data[]
  device_data_latest  device_data_latest[]
  device_data_logs    device_data_logs[]
  maintenance_history maintenance_history[]
  assigned_by_user    users?                   @relation("SocketAssignedBy", fields: [assigned_by], references: [id], map: "outlets_assigned_by_fkey")
  device              device?                  @relation(fields: [device_id], references: [id], map: "outlets_device_id_fkey")
  pdu                 power_distribution_units @relation(fields: [pdu_id], references: [id], onDelete: Cascade, map: "outlets_pdu_id_fkey")

  @@unique([pdu_id, socket_number], map: "unique_pdu_socket")
  @@index([pdu_id], map: "idx_sockets_pdu")
  @@index([device_id], map: "idx_sockets_device")
  @@index([status], map: "idx_sockets_status")
  @@index([is_enabled], map: "idx_sockets_enabled")
  @@index([socket_number], map: "idx_sockets_number")
  @@index([mqtt_broker_host], map: "idx_sockets_mqtt_broker")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// Real-time device state with full MQTT payload fields
/// socket_id is kept for performance optimization in IoMT monitoring scenarios
model device_data_latest {
  device_id     String    @id @db.Uuid
  socket_id     String?   @db.Uuid
  voltage       Float?    @db.Real
  current       Float?    @db.Real
  power         Float?    @db.Real
  frequency     Float?    @db.Real
  power_factor  Float?    @db.Real
  machine_state Boolean?  @default(false)
  socket_state  Boolean?  @default(false)
  sensor_state  Boolean?  @default(false)
  over_voltage  Boolean?  @default(false)
  under_voltage Boolean?  @default(false)
  timestamp     DateTime? @db.Timestamptz(6)
  is_connected  Boolean?  @default(false)
  last_seen_at  DateTime? @db.Timestamptz(6)
  updated_at    DateTime  @default(now()) @db.Timestamptz(6)
  device        device    @relation(fields: [device_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "device_current_state_device_id_fkey")
  socket        sockets?  @relation(fields: [socket_id], references: [id], onUpdate: NoAction, map: "device_current_state_socket_id_fkey")
}

model socket1_data {
  id            Int       @id @default(autoincrement())
  voltage       Float?    @db.Real
  current       Float?    @db.Real
  frequency     Float?    @db.Real
  power_factor  Float?    @db.Real
  timestamp     DateTime? @default(now()) @db.Timestamp(6)
  power         Float?    @db.Real
  machine_state Boolean?  @default(false)
  socket_state  Boolean?  @default(false)
  sensor_state  Boolean?  @default(false)
  over_voltage  Boolean?  @default(false)
  under_voltage Boolean?  @default(false)
}

model socket2_data {
  id            Int       @id @default(autoincrement())
  voltage       Float?    @db.Real
  current       Float?    @db.Real
  frequency     Float?    @db.Real
  power_factor  Float?    @db.Real
  timestamp     DateTime? @default(now()) @db.Timestamp(6)
  power         Float?    @db.Real
  machine_state Boolean?  @default(false)
  socket_state  Boolean?  @default(false)
  sensor_state  Boolean?  @default(false)
  over_voltage  Boolean?  @default(false)
  under_voltage Boolean?  @default(false)
}

model socket3_data {
  id            Int       @id @default(autoincrement())
  voltage       Float?    @db.Real
  current       Float?    @db.Real
  frequency     Float?    @db.Real
  power_factor  Float?    @db.Real
  timestamp     DateTime? @default(now()) @db.Timestamp(6)
  power         Float?    @db.Real
  machine_state Boolean?  @default(false)
  socket_state  Boolean?  @default(false)
  sensor_state  Boolean?  @default(false)
  over_voltage  Boolean?  @default(false)
  under_voltage Boolean?  @default(false)
}

model socket4_data {
  id            Int       @id @default(autoincrement())
  voltage       Float?    @db.Real
  current       Float?    @db.Real
  frequency     Float?    @db.Real
  power_factor  Float?    @db.Real
  timestamp     DateTime? @default(now()) @db.Timestamp(6)
  power         Float?    @db.Real
  machine_state Boolean?  @default(false)
  socket_state  Boolean?  @default(false)
  sensor_state  Boolean?  @default(false)
  over_voltage  Boolean?  @default(false)
  under_voltage Boolean?  @default(false)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model maintenance_jobs {
  id                  String              @id @default(dbgenerated("uuid_generate_v4()")) @db.Uuid
  maintenance_id      String              @db.Uuid
  job_number          Int
  name                String              @db.VarChar(255)
  category            String?             @db.VarChar(100)
  description         String?
  start_time          DateTime?           @db.Timestamptz(6)
  end_time            DateTime?           @db.Timestamptz(6)
  duration_minutes    Int?
  status              String?             @default("pending") @db.VarChar(50)
  result              String?             @db.VarChar(50)
  notes               String?
  issues_found        String?
  actions_taken       String?
  created_at          DateTime?           @default(now()) @db.Timestamptz(6)
  updated_at          DateTime?           @default(now()) @db.Timestamptz(6)
  before_metrics      Json?               @default("{}")
  after_metrics       Json?               @default("{}")
  maintenance_history maintenance_history @relation(fields: [maintenance_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_maintenance_jobs_maintenance")

  @@index([maintenance_id], map: "idx_maintenance_jobs_maintenance")
  @@index([maintenance_id, job_number], map: "idx_maintenance_jobs_number")
  @@index([status], map: "idx_maintenance_jobs_status")
  @@index([after_metrics], map: "idx_maintenance_jobs_after_metrics", type: Gin)
  @@index([before_metrics], map: "idx_maintenance_jobs_before_metrics", type: Gin)
}

enum device_status {
  active
  inactive
  maintenance
  decommissioned
  archived
}

enum access_level {
  read
  write
  admin
  none
}

enum alert_severity {
  low
  medium
  high
  critical
}

enum alert_status {
  active
  acknowledged
  resolved
  suppressed
}

enum assignment_role {
  assignee
  reviewer
  escalation
}

enum condition_type {
  greater_than
  less_than
  equal
  between
  not_equal
}

enum escalation_level {
  L1
  L2
  L3
  executive
}

enum maintenance_type {
  preventive
  corrective
  emergency
  calibration
}

enum measurement_data_type {
  numeric
  text
  boolean
  json
}

enum notification_channel {
  email
  sms
  webhook
  push
  slack
  telegram
}

enum notification_status {
  pending
  sent
  failed
  retry
}

enum organization_type {
  hospital
  factory
  school
  office
  laboratory
}

enum report_format {
  pdf
  excel
  csv
  json
}

enum schedule_status {
  pending
  completed
  overdue
  cancelled
}

enum suppression_type {
  manual
  scheduled
  maintenance
}

enum audit_action {
  create
  read
  update
  delete
  login
  logout
  failed_login
  permission_granted
  permission_revoked
  role_assigned
  role_removed
  access_denied
  password_changed
}

enum org_status {
  ACTIVE
  INACTIVE
  PENDING
}

enum maintenance_status {
  completed
  failed
  partial
  cancelled
}

enum maintenance_severity {
  routine
  urgent
  emergency
}

enum device_condition {
  excellent
  good
  fair
  poor
  critical
}

enum device_visibility {
  public
  department
  private
}

enum pdu_type {
  cart
  wall_mount
  floor_stand
  ceiling
  rack
  extension
}

enum socket_status {
  active
  idle
  inactive
  error
  maintenance
}
